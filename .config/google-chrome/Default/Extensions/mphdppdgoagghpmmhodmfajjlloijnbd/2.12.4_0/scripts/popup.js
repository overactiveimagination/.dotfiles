var _userInfo=null,_tags=[],keyPrefix="pbuinfo",checkedkey=keyPrefix+"c",namekey=keyPrefix+"n",pwdkey=keyPrefix+"p",authTokenKey=keyPrefix+"_auth_token",nopingKey=keyPrefix+"np",allprivateKey=keyPrefix+"allprivate",alltoreadKey=keyPrefix+"alltoread",noblockquoteKey=keyPrefix+"noblockquote",privateWhenIncognitoKey=keyPrefix+"privatewhenincognito",mainPath="https://api.pinboard.in/v1/",yesIcon="images/icon_color_16.png",noIcon="images/icon_black_16.png",savingIcon="images/icon_grey_saving_19.png",REQ_TIME_OUT=125e3,maxDescLen=500,isBlockquote=function(){var e=localStorage[noblockquoteKey];return"undefined"==typeof e||"false"===e},app=angular.module("popupApp",["ngNotify"]);app.run(["ngNotify",function(e){e.config({position:"bottom",theme:"notificationTheme",html:!0,sticky:"true"})}]),app.controller("PopupCtrl",["$rootScope","$scope","$window","ngNotify",function(e,t,o,n){var a=chrome.extension.getBackgroundPage(),i={enter:13,tab:9,up:38,down:40,ctrl:17,n:78,p:80,space:32},r=1e3,s=60*r,c=60*s,l=24*c,u=7*l;Date.prototype.getTimePassed=function(){var e,t={day:0,hour:0,min:0,sec:0,offset:-1},o=new Date-this;return o<=0?t:(t.offset=o,t.week=Math.floor(o/u),e=o%u,t.day=Math.floor(o/l),e=o%l,t.hour=Math.floor(e/c),e%=c,t.min=Math.floor(e/s),e%=s,t.sec=Math.floor(e/r),t)},o.$rootScope=e,t.$on("login-succeed",function(){d()}),t.$on("logged-out",function(){t.isAnony=!0,t.isLoading=!1,t.$apply()}),t.$on("show-loading",function(e,o){t.isLoading=!0,t.loadingText=o||"Loading...",t.$apply()});var g=function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var o=e[0];chrome.tabs.sendMessage(o.id,{method:"getDescription"},function(e){if("undefined"!=typeof e&&0!==e.data.length){var o=e.data;o.length>maxDescLen&&(o=o.slice(0,maxDescLen)+"..."),isBlockquote()&&(o="<blockquote>"+o+"</blockquote>",t.isQuoteHintShown=!0),t.pageInfo.desc=o,t.$apply()}})})},f=function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0];chrome.tabs.sendMessage(t.id,{method:"getKeywordsSuggestionTags"},function(e){if("undefined"!=typeof e){var o=e.data;a.getSuggest(t.url,o)}else a.getSuggest(t.url)})})},p=function(){var e=a.getTags();e&&e.length&&(t.allTags=e)},d=function(){chrome.tabs.query({active:!0,currentWindow:!0},function(e){var o=e[0],n=a.getPageInfo(o.url);n&&0!=n.isSaved||(n={url:o.url,title:o.title,tag:"",desc:""},n.shared="true"!==localStorage[allprivateKey]&&!("true"===localStorage[privateWhenIncognitoKey]&&o.incognito),n.isPrivate=!n.shared,n.toread="true"===localStorage[alltoreadKey],n.isSaved=!1),n.tag&&(n.tag=n.tag.concat(" ")),n.isPrivate=!n.shared,t.pageInfo=_.clone(n),n.desc||g(),t.isLoading=!1,t.isAnony=!1,t.$apply(),f(),p(),"?focusHack"!=location.search&&(location.search="?focusHack")})};t.chooseTag=function(e){var o=e.charCode?e.charCode:e.keyCode;if(o&&_.indexOf([i.enter,i.tab,i.up,i.down,i.n,i.p,i.ctrl,i.space],o)>=0)if(o==i.enter||o==i.tab)if(t.isShowAutoComplete){e.preventDefault();var n=t.pageInfo.tag.split(" "),a=t.autoCompleteItems[t.activeItemIndex];n.splice(n.length-1,1,a.text),t.pageInfo.tag=n.join(" ")+" ",t.isShowAutoComplete=!1}else o==i.enter&&t.postSubmit();else if(o==i.down||o==i.n&&1==e.ctrlKey){e.preventDefault();var r=t.activeItemIndex+1;r>=t.autoCompleteItems.length&&(r=0),t.autoCompleteItems=_.map(t.autoCompleteItems,function(e){return{text:e.text,isActive:!1}}),t.activeItemIndex=r,t.autoCompleteItems[r].isActive=!0}else if(o==i.up||o==i.p&&1==e.ctrlKey){e.preventDefault();var r=t.activeItemIndex-1;r<0&&(r=t.autoCompleteItems.length-1),t.autoCompleteItems=_.map(t.autoCompleteItems,function(e){return{text:e.text,isActive:!1}}),t.activeItemIndex=r,t.autoCompleteItems[r].isActive=!0}else o==i.space&&(t.isShowAutoComplete=!1)},t.showAutoComplete=function(){var e=t.pageInfo.tag.split(" "),o=e[e.length-1],n=7;if(o){o=o.toLowerCase(),"undefined"==typeof t.allTags&&p();for(var a=t.allTags,i=0,r=[],s=0,c=a.length;s<c&&i<n;s++){var l=a[s].toLowerCase();if(0==l.indexOf(o)){var u={text:a[s],isActive:!1};r.push(u),i+=1}}if(i){t.autoCompleteItems=r.reverse(),t.autoCompleteItems[0].isActive=!0,t.activeItemIndex=0,t.isShowAutoComplete=!0;var g=$("#tag"),f=$("#tag").offset();f.top=f.top+g.outerHeight(),t.autoCompleteStyle={left:f.left,top:f.top}}else t.isShowAutoComplete=!1}else t.isShowAutoComplete=!1},t.$on("render-page-info",d);var m=function(e){var o=t.pageInfo.tag;$.inArray(e,o.split(" "))==-1&&(t.pageInfo.tag=o+" "+e)};t.addTags=function(e){$.each(e,function(e,t){m(t)})},t.toggleTag=function(e){var o=t.pageInfo.tag.split(" ");o.indexOf(e)===-1?o.push(e):o.splice(o.indexOf(e),1),t.pageInfo.tag=o.join(" ")},t.$on("render-suggests",function(e,o){t.suggests=o,t.$apply()}),t.openUrl=function(e){chrome.tabs.create({url:e});var t=chrome.extension.getViews({type:"popup"})[0];t&&t.close()},t.renderSavedTime=function(e){var t=new Date(e).getTimePassed(),o="previously saved ";t.week,t.day,t.hour;return o=t.offset>u?o.concat(t.week," ","weeks ago"):t.offset>l?o.concat(t.day," ","days ago"):t.offset>c?o.concat(t.hour," ","hours ago"):o.concat("just now")},t.postSubmit=function(){t.isLoading=!0,t.loadingText="Saving...";var e=_.clone(t.pageInfo);e.shared=t.pageInfo.isPrivate?"no":"yes",e.toread=t.pageInfo.toread?"yes":"no",a.addPost(e),window.close()},t.showDeleteConfirm=function(){t.isShowDeleteConfirm=!0},t.postDelete=function(){t.loadingText="Deleting...",chrome.tabs.query({active:!0,currentWindow:!0},function(e){var t=e[0];a.deletePost(t.url)})},t.loginSubmit=function(){t.userLogin.authToken&&(t.loadingText="Logging in...",t.isLoading=!0,a.login(t.userLogin.authToken))},t.logout=function(){a.logout()};var h=function(){var e=a.getNotification();e&&n.set(e.message,{html:!0,type:e.type},a.closeNotification),t.isLoading=!1};t.$on("show-notification",h);var v=a.getUserInfo();t.userInfo=v,t.isAnony=!v||!v.isChecked,t.isLoading=!1,t.loadingText="Loading...",t.isAnony||d(),n.addTheme("notificationTheme","notification-theme"),h()}]);
//# sourceMappingURL=popup.js.map
